<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Emergency Med Box</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    /* (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) */
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
<div class="max-w-5xl mx-auto p-4 md:p-6">
  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á / ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°... -->

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
  <section id="view-output" class="card p-4 hidden">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-xl font-semibold">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡∏≤</h2>
    </div>
    <div id="dashboardAll" class="space-y-4"></div>
  </section>
</div>

<!-- (QR Modal, Need-add Modal) -->

<script>
const API_BASE = 'https://script.google.com/macros/s/.../exec';
let currentBox = localStorage.getItem('em_box') || '';

/* (Helpers, loadBoxes, loadItems, loadLots, addNewLot, submitData, etc.) */

async function loadDashboardAll(){
  if (!currentBox) return;
  const d1 = await apiGet({ action: 'dashboard', box: currentBox });
  const d2 = await apiGet({ action: 'summary_all' });
  renderDashboardAll(d1, d2);
}

function renderDashboardAll(dBox, dAll){
  const wrap = document.getElementById('dashboardAll');
  wrap.innerHTML = '';

  // Card: ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  const card1 = document.createElement('div');
  card1.className = 'p-4 border rounded bg-white';
  card1.innerHTML = `
    <div class="font-semibold mb-2">‡∏Å‡∏•‡πà‡∏≠‡∏á ${currentBox}</div>
    <div class="mb-1">üîπ <b>‡∏¢‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</b> ${dBox?.soonestDate || '‚Äî'}</div>
    <div class="mb-1">üì¶ <b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</b> ${dBox?.soonest?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
    <div class="mb-1">üìä <b>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</b> ${dBox?.visits?.total || 0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${dBox?.visits?.lastDate || '-'})</div>
    <div class="muted text-sm">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ EXP ${dBox?.visits?.byReason?.['‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ EXP']||0}, ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á ${dBox?.visits?.byReason?.['‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á']||0}, ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ${dBox?.visits?.byReason?.['‡∏≠‡∏∑‡πà‡∏ô‡πÜ']||0}</div>
  `;
  wrap.appendChild(card1);

  // Card: ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á
  const card2 = document.createElement('div');
  card2.className = 'p-4 border rounded bg-white';
  card2.innerHTML = `
    <div class="font-semibold mb-2">üìã ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á</div>
    <div class="mb-1">üßæ <b>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</b> ${dAll?.total || 0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
    <div class="muted text-sm">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ EXP ${dAll?.reasons?.['‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ EXP']||0}, ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á ${dAll?.reasons?.['‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á']||0}, ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ${dAll?.reasons?.['‡∏≠‡∏∑‡πà‡∏ô‡πÜ']||0}</div>
  `;
  wrap.appendChild(card2);
}

window.addEventListener('DOMContentLoaded', () => {
  /* loadBoxes, setBoxBadge, etc. */

  document.getElementById('tab-view').onclick = () => {
    if (!currentBox) { switchView('view-select'); }
    else { switchView('view-output'); loadDashboardAll(); }
  };
});
</script>
</body>
</html>
